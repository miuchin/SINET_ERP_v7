<!DOCTYPE html>
<html lang="sr" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SINET Zadaci v16.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="sinet_core_v7.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }; 
        SINET.Theme.apply(); // Apply immediately
    </script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        body { transition: background-color 0.3s; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        /* Dark Mode Styles */
        .dark body { background-color: #0f172a; color: #e2e8f0; }
        .dark .bg-white { background-color: #1e293b; color: #e2e8f0; border-color: #334155; }
        .dark .text-slate-800 { color: #f1f5f9; }
        .dark .text-slate-500 { color: #94a3b8; }
        .dark input, .dark select, .dark textarea { background-color: #334155; color: white; border-color: #475569; }
        .dark .hover\:bg-slate-50:hover { background-color: #334155; }
    </style>
</head>
<body class="bg-amber-50 h-screen flex flex-col">

    <div class="bg-amber-600 dark:bg-amber-900 text-white p-4 shadow-lg flex justify-between items-center shrink-0">
        <div class="flex items-center gap-3">
            <button onclick="window.location.href='index.html'" class="p-2 rounded-full hover:bg-amber-500"><span class="material-icons-round">arrow_back</span></button>
            <div>
                <h1 class="text-lg font-bold flex items-center gap-2"><span class="material-icons-round text-amber-200">check_circle</span> TASKOVI & PODSETNIK</h1>
                <p class="text-[10px] text-amber-200 uppercase tracking-widest">Organizacija Vremena</p>
            </div>
        </div>
        <button onclick="SINET.Theme.toggle()" class="p-2 rounded-full hover:bg-white/10"><span class="material-icons-round">dark_mode</span></button>
    </div>

    <div class="flex-1 p-4 md:p-8 max-w-4xl mx-auto w-full overflow-y-auto hide-scroll">
        
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-amber-100 dark:border-slate-700 mb-6 flex flex-col md:flex-row gap-2 items-end">
            <div class="flex-1 w-full">
                <label class="text-[9px] font-bold text-slate-400 uppercase ml-1">NOVI ZADATAK</label>
                <input id="t-title" list="task-suggestions" class="w-full p-3 border rounded-xl font-bold outline-none focus:ring-2 focus:ring-amber-500" placeholder="Izaberi ili upiÅ¡i...">
                
                <datalist id="task-suggestions">
                    <option value="Pozovi knjigovoÄ‘u">
                    <option value="Plati PDV">
                    <option value="Isplata zarada (Plate)">
                    <option value="Porez na dobit (Akontacija)">
                    <option value="Porez i doprinosi">
                    <option value="PoÅ¡alji ponudu klijentu">
                    <option value="Proveri naplatu (IOS)">
                    <option value="NaruÄi kancelarijski materijal">
                    <option value="Servis opreme">
                    <option value="Sastanak sa klijentom">
                    <option value="Plati struju i komunalije">
                </datalist>
            </div>
            
            <div class="flex gap-2 w-full md:w-auto">
                <div class="w-1/2 md:w-32">
                    <label class="text-[9px] font-bold text-slate-400 uppercase ml-1">ROK</label>
                    <input type="date" id="t-date" class="w-full p-3 border rounded-xl font-mono text-sm outline-none">
                </div>
                <div class="w-1/2 md:w-24">
                    <label class="text-[9px] font-bold text-slate-400 uppercase ml-1">PRIORITET</label>
                    <select id="t-prio" class="w-full p-3 border rounded-xl font-bold text-sm outline-none bg-white">
                        <option value="HIGH">HITNO</option>
                        <option value="MEDIUM" selected>SREDNJE</option>
                        <option value="LOW">NISKO</option>
                    </select>
                </div>
                <button onclick="Task.add()" class="bg-amber-500 hover:bg-amber-600 text-white p-3 rounded-xl shadow-lg font-bold w-12 flex justify-center items-center h-[46px]">
                    <span class="material-icons-round">add</span>
                </button>
            </div>
        </div>

        <div class="space-y-4">
            <div>
                <h3 class="font-bold text-slate-500 text-xs uppercase mb-2 ml-2">URADITI (PENDING)</h3>
                <div id="list-pending" class="space-y-2"></div>
            </div>
            <div class="mt-8 opacity-60">
                <h3 class="font-bold text-slate-500 text-xs uppercase mb-2 ml-2">ZAVRÅ ENO (DONE)</h3>
                <div id="list-done" class="space-y-2"></div>
            </div>
        </div>

    </div>

    <script>
        const Task = {
            list: [],

            init: () => {
                Task.list = SINET.DB.get('tasks') || [];
                document.getElementById('t-date').valueAsDate = new Date();
                Task.render();
            },

            add: () => {
                const title = document.getElementById('t-title').value;
                if(!title) return alert("UpiÅ¡ite naziv zadatka!");
                
                Task.list.unshift({
                    id: SINET.Util.uuid(),
                    title: title,
                    date: document.getElementById('t-date').value,
                    priority: document.getElementById('t-prio').value,
                    done: false
                });
                
                SINET.DB.save('tasks', Task.list);
                document.getElementById('t-title').value = "";
                Task.render();
            },

            toggle: (id) => {
                const t = Task.list.find(x => x.id === id);
                if(t) { t.done = !t.done; SINET.DB.save('tasks', Task.list); Task.render(); }
            },

            delete: (id) => {
                if(confirm("Obrisati zadatak?")) {
                    Task.list = Task.list.filter(x => x.id !== id);
                    SINET.DB.save('tasks', Task.list);
                    Task.render();
                }
            },

            render: () => {
                const pendingEl = document.getElementById('list-pending');
                const doneEl = document.getElementById('list-done');
                
                // Sort: High priority first, then by date
                const sorted = Task.list.sort((a,b) => {
                    const pMap = { 'HIGH': 3, 'MEDIUM': 2, 'LOW': 1 };
                    if(pMap[b.priority] !== pMap[a.priority]) return pMap[b.priority] - pMap[a.priority];
                    return a.date.localeCompare(b.date);
                });

                const getHtml = (t) => {
                    const color = t.priority === 'HIGH' ? 'text-red-600 bg-red-50 border-red-200' : (t.priority === 'MEDIUM' ? 'text-amber-600 bg-amber-50 border-amber-200' : 'text-green-600 bg-green-50 border-green-200');
                    const checkIcon = t.done ? 'check_box' : 'check_box_outline_blank';
                    const strike = t.done ? 'line-through text-slate-400' : 'text-slate-800 dark:text-slate-200';
                    
                    return `
                    <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex items-center gap-3 group">
                        <button onclick="Task.toggle('${t.id}')" class="text-slate-400 hover:text-amber-500 transition">
                            <span class="material-icons-round text-2xl">${checkIcon}</span>
                        </button>
                        <div class="flex-1">
                            <h4 class="font-bold text-sm ${strike}">${t.title}</h4>
                            <p class="text-[10px] text-slate-400 flex gap-2">
                                <span>ðŸ“… ${SINET.Util.fmtDate(t.date)}</span>
                                <span class="font-bold ${t.priority === 'HIGH' ? 'text-red-500' : ''}">${t.priority}</span>
                            </p>
                        </div>
                        <button onclick="Task.delete('${t.id}')" class="opacity-0 group-hover:opacity-100 text-red-400 p-2 hover:bg-red-50 rounded-full transition">
                            <span class="material-icons-round text-sm">delete</span>
                        </button>
                    </div>`;
                };

                pendingEl.innerHTML = sorted.filter(t => !t.done).map(getHtml).join('') || '<div class="text-center text-xs text-slate-400 py-4">Nema aktivnih zadataka. Bravo!</div>';
                doneEl.innerHTML = sorted.filter(t => t.done).map(getHtml).join('');
            }
        };
        Task.init();
    </script>
</body>
</html>
